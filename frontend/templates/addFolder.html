{{define "content"}}
<body class="bg-gray-100 p-8">
  <div class="max-w-md mx-auto bg-white p-6 rounded-lg shadow-md">
    <div class="rounded-md bg-white px-3 pb-1.5 pt-2.5 outline outline-1 -outline-offset-1 outline-gray-300 focus-within:outline focus-within:outline-2 focus-within:-outline-offset-2 focus-within:outline-indigo-600">
        <label for="folderName" class="block text-xs font-medium text-gray-900">Folder Name</label>
        <input type="text" name="folderName" id="folderName" class="block w-full text-gray-900 placeholder:text-gray-400 focus:outline focus:outline-0 sm:text-sm/6" placeholder="Folder 1">
      </div>
      <div>
        <label for="location" class="block mt-4 text-sm/6 font-medium text-gray-900">Location</label>
        <div class="mt-2 grid grid-cols-1">
          <select id="folder" name="folder" class="col-start-1 row-start-1 w-full appearance-none rounded-md bg-white py-1.5 pl-3 pr-8 text-base text-gray-900 outline outline-1 -outline-offset-1 outline-gray-300 focus:outline focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6">
            <option></option>
            {{range .folders}}
            <option>{{.Path}}</option>
            {{end}}
          </select>
          <svg class="pointer-events-none col-start-1 row-start-1 mr-2 size-5 self-center justify-self-end text-gray-500 sm:size-4" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true" data-slot="icon">
            <path fill-rule="evenodd" d="M4.22 6.22a.75.75 0 0 1 1.06 0L8 8.94l2.72-2.72a.75.75 0 1 1 1.06 1.06l-3.25 3.25a.75.75 0 0 1-1.06 0L4.22 7.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd" />
          </svg>
        </div>
      </div>
      <button 
          id="uploadButton" 
          class="mt-4 w-full bg-blue-500 text-white py-2 rounded hover:bg-blue-600"
      >
          Add Folder
      </button>
      
      <div id="status" class="mt-4 text-center"></div>
  </div>

  <script>
      document.addEventListener('DOMContentLoaded', () => {
          let folderName = document.getElementById('folderName');
          const uploadButton = document.getElementById('uploadButton');
          const statusDiv = document.getElementById('status');
          const folder = document.getElementById('folder');
          const apiBaseUrl =  'https://storage.barebasics.shop/';
          uploadButton.addEventListener('click', async () => {
            console.log(folderName.value);

            // Get the selected file
              if (!folderName.value) {
                  statusDiv.innerHTML = '<p class="text-red-500">No folder name</p>';
                  return;
              }

              // Retrieve token from localStorage
              const apiKeyCookie = document.cookie.split('; ').find(row => row.startsWith('api-key='));
              
              if (!apiKeyCookie) {
                  statusDiv.innerHTML = '<p class="text-red-500">No authentication token found</p>';
                  return;
              }

              // Create FormData
              const formData = new FormData();
              let completeFolderName;
              if (folder.value !== '') {
                completeFolderName = folder.value + '/' + folderName.value;                
              } else {
                completeFolderName = folderName.value;
              }
              formData.append('folder', completeFolderName);

              try {
                  // Show loading state
                  statusDiv.innerHTML = `
                      <div class="flex items-center justify-center">
                          <svg class="animate-spin h-5 w-5 mr-3 text-blue-500" viewBox="0 0 24 24">
                              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                          </svg>
                          <span>Uploading...</span>
                      </div>
                  `;
                    const apiKey = apiKeyCookie.split('=')[1];
                  // Send request
                  const response = await fetch(apiBaseUrl+'folder/add/', {
                      method: 'POST',
                      headers: {
                          'X-API-Key': apiKey,
                          // Uncomment if not using FormData
                          // 'Content-Type': 'application/octet-stream'
                      },
                      body: formData
                  });

                  // Handle response
                  if (!response.ok) {
                      const errorText = await response.text();
                      throw new Error(errorText || 'Operation failed');
                  }

                  const result = await response.json();

                  // Success state
                  statusDiv.innerHTML = `
                      <p class="text-green-500">
                          Operation successful! 
                          ${result.message ? result.message : 'Folder Added'}
                      </p>
                  `;

                  // Optional: clear file input after successful upload
                  folderName.value = '';

              } catch (error) {
                  // Error handling
                  console.error('Upload error:', error);
                  statusDiv.innerHTML = `
                      <p class="text-red-500">
                          Upload failed: ${error.message}
                      </p>
                  `;
              }
          });
      });

      // Optional: Set token from cookie to localStorage on page load
      document.addEventListener('DOMContentLoaded', () => {
          // Extract token from cookie
          const cookies = document.cookie.split('; ');
          const tokenCookie = cookies.find(row => row.startsWith('api-key='));
          
          if (tokenCookie) {
              const token = tokenCookie.split('=')[1];
              localStorage.setItem('api-key', token);
          }
      });
  </script>
  </body>

  
{{end}}